권재욱(jaeuki@naver.com)

# 시스템 취약점 진단 및 분석
ISMS-P = Information Security Management System - Privacy    
PIA       
ISO/IEC 27001    
ISO/IEC 27017    
ISO/IEC 27018    
ISO/IEC 27701    
ISO/IEC 27799    
TISAX / VCS    
ISO/SZE21434    
MDR 의료    
KFDA 한국 식약처    
FDA 미국 식약처    
CSMS - cyber security management System    
UNECE RISS    
</br></br>

### 컨설팅 제일 먼저 들어가면 

관리체계 / PM   - 고/특 1명   
시스템진단(기술) - 초/중 1명   
Web/App 진단    - 중/고 0.5

## 취약점 진단
PDCA => Plan, Do, Check, Act   
ISMS-P

실제로 가면   
☆CAP-DO 로 진행한다   
CAP-DO => Check, Act, Plan, Do   
```
환경분석 -> 현황분석 -> 위험평가 -> GAP분석 -> 관리체계 구축ㆍ운영

위험평가 :
RM = RA + RT
관리체계 RA
기술적 취약점 RA

RA
------------------------
A. T. V취약점
인프라(서버, 미들웨어, 네트워크, 보안)
Web/APP

RT
------------------------
조치계획 수립/이행


GAP 분석 : 
비교점을 가지고 비교점 대비 상황을 확인해보는 것   
목표를 설정한 후 목표와 실제 성과 조사를 통해 두 수치간의 차리(GAP)을 파악하고 GAP의 원인분석 및 해결방안을 모색하는 분석 기법

관리체계 구축ㆍ운영 :
정보보안 규정(정책, 지침)(Plan)
보안활동(Do)
내부감사/보안감사(Check)
Act
```
 
ISMS-P 컨설팅의 궁극적 목적 : 인증을받는 것


안랩의 컨설팅 서비스 확인   
컨설팅 방법론   
이런 것들을 기반으로 예상 질문 도출 가능
</br></br>

### 컨설팅하면서 제일 어려운 거?
의사소통.
</br></br></br>


# 위험관리 개요
## 위험의 정의
### 위험이란?
- 원하지 않는 사건 (위협, Treat)이
- 자산의 약점(취약점, Vulnerability)을 이용하여
- 자산(Asset)에 부정적인 영향(손실)을 미칠 수 있는 가능성

자산이 있고, 취약점이 있고, 위협이 있을 가능성

근데 위협과 취약점의 차이가 애매함.   
그래서 어떤 곳에서는 위협과 취약점을 합쳐버림   
= 우려 사항

### 위험 계산 관련 공식
위험 = 발생 가능성 X 손실의 정도   
위험 = 발생 가능성 X 심각도   
위험 = f{자산, 위협, 취약성}

### Safety vs Security   
Safety > Security

## 위험관리의 이해
### 정보보호 위험관리 RM (Risk Management)
- 정보보호 측면에서 조직 및 조직의 자산을 안전하게 보호할 목적으로
- 위험을 식별ㆍ평가 하고
- 비용 대비 효과 측면에서 적절한 보호대책을 수립ㆍ적용하는 일련의 과정


### Safety vs Security   
Safety > Security



# 위험관리 표준
## ISO/IEC27005
위험 평가   
위험 식별 : 자산 식별, 취약성 평가   
위험 분석 :    
위험 수준 평가 : 

```
어떤 위험은 7,8,9이고
어떤 위험은 3,4,5일 때
DoA를 6으로 지정했음.

DoA를 기점으로 전략이 달라짐
3,4,5 위험은 수용ㅎ고
7,8,9 위험
    이 중에서도 수용하는 경우가 있음.
    돈이 너무 많이 들 수도 있고 하는 등
일단 7,8,9는 위험 처리 대상이 된다.

7,8,9에 control을 해서
DoA 기준 밑으로 보는 것을 목적으로 함
7 -> 3 으로 위험 평가가 변화를 하면 수용함.
8 -> 7 으로 위험 평가가 변화하면 다른 방법을 찾든 DoA 밑으로 내려보낼 수 있는 것을 찾음.


이제 취약점 진단 다 했으면
대책마련

개선방안, 목표일, 담당자 지정
해야 함
```

위험도 :   
기밀성     
무결성    
가용성   

위험처리 :   
단기1 3   
중기3 6   
장기6 12   
회사는 1 3 6 인데    
우리는 3 6 12이라 다르면?   

우리 회사 방법론이 아니라   
해당 회사 방법론에 맞춰서 해줘야 함

## 상황 설정
전체 프로세스 및 상황에 영향을 미치는 위험관리의 목적 

## 위험평가(Assessment)
위험 식별   
위험 분석   
위험 수준 평가(Evaluation 산정)

### 위험식별

### 위범분석
정성적 위험분석    
정량적 위험분석

Likelihood + Consequences + Estimate Level of Risk

### AHSLXJFLD ALC RJAXH
EOS    
End Of Service/Support

EOL   
End Of Life


# 위험 관리 절차
## 세부 수행 절차
### 자산평가 
문서, 매체는 잘 신경을 안쓰고   
서버, 네트워크 같은 것들에만 신경을 씀
```
밑에 중에서 어디까지가 자산일까?

Data
App
Middle Ware
OS
HardWare
Hypervisor

A : 모든 것.
```
Middle Ware : 웹WAS, DB WAS

#### 중요도 평가 기준
- 상 : 치명적인 피해를 줄 수 있는 수준
- 중 : 상당한 문제를 발생시킬 수 있는 수준
- 하 : 영향이 미미한 수준
</br></br>

ISMS-P   
관리체셰 16개   
보호대책 64개   
개인정보 21개   
총 101개


### 3. 위험도 산정
위험도 = (자산 중요도 + 위협 정도 + 취약성 정도) - 기존 보호대책 정도

### 4. 위험처리 전략
위험관리수준(DoA : Degree of Assur~)

### 5. 보호대책 수립
DoA 수준에 따라서 보호대책 마련


## 접근법
기준선 접근법

## 법
개인정보보호법   
정보통신망법    
위치정보보호법

## 관리적/물리적 영역
ISMS 같은 기준을 가지고 함

## 위험평가 방법론
자산분석 - 위협분석 - 취약성분석 - 위험분석

### 자산분석
서버, 네트워크, 보안시스템

자산등급 = 기밀서 + 무결성 + 가용성

등급을 매긴다

### 위협분석
발생 가능성이 높으면 등급 높게 주고

### 취약성 분석

### 위험분석
위험등급 = 자산 X 위협 X 취약성

1~27점 


### 위험관리방법
회피, 감소, 수용 등

## DoA
위협의 range 1~27  
그중에서 뭘 할지 정하는 곳

### DoA 산정
7~14 = Medium 산정을 했다고 침



# 취약점 진단 개요
## 취약점 개요

CCE 취약점   
CVE 취약점    
CWE 취약점  
기타 보안 취약점

CCE 취약점   
운영자 조치 가능   
에러메시지 처리 개선 요구를 하면    
이걸 왜 개선해야 하냐고 많이 물어봄


CVE 취약점   
제조사 공식 패치 의존

CWE 취약점    
개발자 수정 가능   

## 보안 약점과 보안 취약점
동적분석, 정적분석

## 주요 취약점 진단 유형
- 웹 취약점 스캐닝   
    - 과탐과 오탐이 많음
    - 자동화된 툴이 있더라도 사람이 개입할 수밖에 없음
- 웹 모의해킹    
- 소스코드 보안약점 진단    
- 인프라 취약점 진단
    - 자동점검(스크립트 기반)
    - 수동점검(체크리스트 기반)

## 취약점 진단인력의 요구 역량
- 정보시스템 서비스 등의 기술에 대한 이해(TCP/IP 등 표준 프로토콜, 보안기술, 웹 기술 등)
- 취약점에 대한 이해
- 진단 업무에 대한 이해(진단 전 준비 업무, 진단 시 수행 업무, 진단 실시 후 지원 업무 등)
- 진단도구에 대한 이해(도구의 특징, 도구 준비, 실시 준비 및 설정, 수행, 결과 확인 및 분석 등)
- 컴플라이언스에 대한 이해(관련 법률, 규제 등)
- 위험관리에 대한 이해(위험평사, 위험차이 등)
- 기타(웹 응용프로그램 개발 관련 지식, 진단 대상 시스템에 대한 이해, 현업 업무에 대한 이해 등)
- 의사소통 역량, 보고서 작성 역량 등

보고서 잘 쓰는 법? => 따라해라 

특이사항이 없다? -> 결과적으로는 아무 것도 안나올 수 있는데   
이것도 저것도 그것도 다 해봤는데 특이사항이 없다 라고 적는 것하고    
그냥 특이사항 없다고 적어놓는 거랑은 다르다.   
보고서를 쓸 때 입장을 바꿔놓고 써라


## 취약점 진단 수행
진단 수행 준비 :    
진단 대상 확인, 사전 요구사항 확인, 작업 환경 준비 등

진단 수행 :   
자동 진단 도구를 사용한 진단, 수작업을 통한 진단, 보고서 작성 등

진단 수행후 대응 :   
설명회 실시, 진단 실시 후 문의 대응, 재진단(이행점검) 등

전체 흐름이 머릿속에 그려져야 한다

### 진단 수행 준비
- 진단 대상 확인
    - 진단 대상이 되는 웹 프로그램을 선정하고 우선 순위를 책정
- 수행 내용 설명
    - 진단 내용과 서비스 제공의 흐름, 진단을 할 때의 주의사항 등 진단수행에 대한 내용을 설명
- 사전 청취 
    - 진단 실시 형태와 진단 대상 환경 등 진단에 필요한 정보를 확인
- 환경 및 데이터 준비
    - 진단에 필요한 계정 정보나 각종 권한 등을 준비
- 현장 작업 환경 준비
    - 현장에서 진단하는 경우 진단 대상 네트워크에 연결하는 방법, 작업 장소 등에 대한 준비


## 진단 수행 준비
### 진단 대상 확인
자산대장에 있는 전체가 진단의 대상임.   
하지만 고객의 특성을 고려해서 제외할 때도 있음

### 수행 내용 설명
설명을 해줘야 함

### 사전 청취
블라인드 형태로 하라는 경우도 있음    
최소한의 정보를 알려주고 하라는 경우도 있음

어떤 정보를 가지고 해야 하냐?

원격에서 할건지?   
내부에서 할건지?   
일정 등    
수행계획서에 다 작성이 되어야 함

☆금지사항 확인 : 수행하지 말아야 할 취약점 테스트, 접근 또는 취약점 테스트의 범위에서 제외해야 할 기능, 진단 수행 시 특정 시간을 제외 해야 하는지 여부 등

### 환경 및 데이터 준비
- 진단을 수행하는 PC의 IP를 사전에 등록해 원활하게 접속이 가능하도록 함   
- 진단 대상에 접속하기 위한 정보 취득
- ☆보안 장비나 관제 서비스 등에 진단자 IP를 예외처리
    - OWASP TOP 10 
    - 정책 ON/OFF 했을 때 2개의 차이는?
        - Web에 취약점을 알아고 WAF에서 막을 수 있어서 정확한 진단이 불가능함
        - WAF, WF 등 정책을 OFF 해놓고 해야 Web만 가지고 있는 순수한 취약점을 확인 가능함
        - 정책은 ON 시켜놓고 하면 이상함

### 환경 및 데이터 준비
- 테스트 환경 또는 스테이징 환경이 있는지 파악
- 진단 수행전 데이터 백업 요청
    - 혹시나 하니까
- 진단 수행 전 테스트를 위한 더미 데이터 입력 요청

### 현장 작업 환경 준비
- 진단을 수행할 장비에 할당될 IP 주소 등의 정보
- 들어가서 해야 하면 물리적인 업무 환경을 제공 받아야 함(LAN 포트 등)

금지사항
- 진단 대상 외 대상에 진단 수행 X
- 진단 시간 외 진단 수행 X
- 진단 결과를 허가 없이 공개 X


## 진단 수행
- 테스트 케이스 작성
    - 진단 대상 기록
    - 시나리오 작성
- 취약점 진단 실시
    - 자동 진단 도구
    - 수동 진단 보조도구
- 진단 결과 검증
    - 수동 진단을 통한 결과 검증
- 보고서 작성


### 테스트 케이스 작성
시나리오 등을 어떻게 검증할 거냐   
보통 정찰을 하면서 내부 정보를 수집하는 데    
내부 정보의 취약점을 찾아보는 것

### 취약점 진단 실시
도구 사용의 방법에 대해서 알면 좋음

### 진단 결과 검증
최신 버전이 아니라고 무조건 미흡은 아님    
정말 취약인지 아닌지 검증을 해봐야 함. 

고객은 항상 물어봄    
이게 왜 취약이예요?   
왜요?  
이런 거에 대한 대답을 항상 준비하고 있어야 함

그렇기 때문에 반드시 검증을 해봐야 함

### 보고서 작성
보고서 작성 
</br></br></br>

### ☆자동 진단 도구
테스트 케이스 작성 기능    
취약점 진단 기능    
보고서 작성 기능

유용하게 쓸 수 있는 진단 항목
- 매개변수에 값을 삽입해 발견해야 하는 취약점
- HTML 이나 쿠키 등 보안 기능 미비
- 디렉토리 및 파일 발견
    - robots.txt
    - crossdomain

자동 진단 도구에서 발견하기 어려운 취약점 및 기능
- 사람이 만지면서 나오는 취약점들은 자동화 도구로는 찾기 어려울 수 있음

자동 진단 도구에서 발견하기 어려운 취약점들이 뭔지 생각해봐라   
ex) ssllabs.com




### 수동 진단 도구
프록시 - 패킷을 잡아서 확인하거나, 임의의 값을 넣어서 보내보는 것    
리피터 - 반복 전송 기능


### 오탐지 및 누락
- ☆오탐지 : 취약점이 아니지만 취약점으로 판단하는 것   
판단은 인간이 해야 함

### 진단 결과 보고서 중요성
결국 남는 건 보고서임

### 보고서 주요 내용
```
1. 표지
2. 목차
3. 소개
4. 진단 수행 개요
5. 진단 결과
```

### 보고서 종합평가
총평

앞으로 어떻게 되는가요? 라고 물어보면....    
잘 대답해야지

### 개별 취약점 보고
증빙을 넣어놔야 다시 확인 가능

## 취약점 진단 도구
정보 수집
- Nmap
- Wireshark

웹
- OWASP ZAP
- Burp Proxy
- Fiddler


### Nmap
port Scanning 툴로서 호스트나 네트워크를 스캐닝할 때 사용하는 시스템 보안툴

열려있는 포트를 확인 가능

취약점 진단 항목에 보면 불필요한 포트는 차단해야 함.   
OS 설치하게 되면 기본적으로 열려있는 port가 있음   
그런 것 들을 막아야 함.

### OWASP ZAP(Zed Attack Proxy)

### Burp Proxy
인터셉터   
스캐너   
Intruder    
Repeater

### Wireshark
패킷 확인

### Fiddler
딱히 아무 말 안 함
</br></br></br>

# OWASP TOP 10
- Injection
    - SQL Injection
- 안전하지 않은 디자인
    - 아키텍처 구조 결함
- 보안구성 오류
    - CCE 취약점
- 취약하고 오래된 구성요소
    - 안전하지 않은 버전 사용
- 식별 및 인증 실패
    - 권한 없는 사람의 접근
- 소프트웨어 및 데이터 무결성 오류
- 보안 로깅 및 모니터링 실패 
    - 접속기록에 대한 로그
        - 기록
            - 5가지 기록을 해라
        - 보관
            - 1년이상 보관
            - 특정 경우엔 2년 이상
        - 검토
            - 월 1회이상 검토
- 서버측 요청 위조
    - 입력값 검증
    - 접근 가능한 것들을 사전에 정의하고 화이트리스트 등록


## 소프트웨어 개발 보안 정의
### SW 개발 보안
☆☆약점과 취약점 용어 정의 했음

보안약점   
보안취약점


## 대상 및 범위
공공기관   
정보시스템 개발단계에서 SW 보안약점 제거 조치 의무화

## SW 보안 강화 활동
웹 어플리케이션 취약점을 보완하기 위한 활동

- 가. 입력데이터 검증 및 표현
    - 사전 요청이나 입력되는 값들에 대해서 유효하지 않은 값들을 차단해야 한다는 내용
- 나. 보안기능
    - 응용프로그램 안에서 요구되는 보안 기능들이 목록화
    - 이런 항목들이 설계 단계에서 잘 적용되어 있는지 확인하는 것
- 다. 에러처리
    - 불필요하거나 과도한 정보를 주는 것은 바람직하지 않다.
- 세션통제
    - 클라이언트와 서버간의 세션
    - 정상적인 요청이 일어나지 않으면 적정시간 이후에 자동 종료되게 하는 것



## 주요 보안 약점 
### 운영체제 명령어 삽입
입력 데이터 값을 이용해서 운영체제의 명령인 것처럼 작동하게 하는 것

### XSS
크로스 사이트 스크립팅

### 위험한 형식의 파일 업로드
웹쉘 업로드하여 시스템 명령어 수행할 수 있는 쉘 획득    
키로그 설치하여 로그인 정보 추출     
악성코드 파일 업로드하여 다운받은 사용자의 시스템을 감염


### 크로스사이트 요청 위조
입력화면 폼은 GET방식 대신 POST 방식으로 사용   

### 취약한 암호 알고리즘
현재시점에서 안전한 암호화 알고리즘이 무엇인지 확인하여 사용

암호화 키 사용 가이드

### 중요정보 평문 전송
TLS 1.3 버전을 써야 하는데  
실제로 점검을 해보면 TLS 1.0을 많이 쓴다

### 부적절한 인가
권한이 잘못되면 기밀성과 무결성에 문제가 생김    
파라미터 조작해서 권한 없는 사람이 있는 것처럼 하는 경우 차단

### 반복된 인증시도 제한 기능 부재
딕셔너리 어택

임계값을 걸어놓고 횟수 초과하면 어떻게 할지에 대해서 정해야함

### 취약한 비밀번호 허용
이런 것들을 활용해서 딕셔너리 어택으로도 사용


# 보안취약점 정보 수집 사이트
## CWE
https://cve.mitre.org/   
https://sans.org/
https://owasp.org/

위협 인텔리전스

## 주통기반
상 중 하   
취약점에 대한 부분 

점검해야 할 내용과 왜 하는지?

### 보고서 내용
점검 내용   
점검목적   
보안위협   
참고   
판단기준 - 양호, 취약   
조치방법

위협이 왜 위협인지?? 정리해라~~~~~~~~~~~~~~~    
이걸 알아둬야 나중에 도움이 된다




## 사족
주통기반에서 취약점 진단을 하는데   
관리체계에서 취약점 진단도 있고   
웹 취약점 진단도 있음 

CCE, CVE, CWE 4가지 각각 특성


진단업무 전반 절차
진단 준비, 진단수행할 때 어떤ㅇ ㅓㅂ무를 하고
고려하고 유의해야 할점이 무엇인지?
사후 결과보고하고 이후에 뭐 하는 거에서
어떤 걸 해야하는지 
전반적으로


웹 취약점 진단과 관련해서
OWASP TOP 10 어떤 항목이 있는지 봤고


OWASP TOP 10 에 대한 시큐어코딩
나중에 실제 위협과 어떤 연관성이 있는지
실제 어떤 대응???? 이게 먼지 모르겠다
